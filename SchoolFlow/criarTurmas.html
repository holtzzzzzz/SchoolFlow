<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css">
    <title>Criar Turma - SchoolFlow</title>
  </head>
  <body>
    <nav class="sidebar">
      <div class="sidebar-header">
        <img src="imgs/menu.png" alt="Menu">
      </div>
      <div class="nav-links">
        <a href="indexSecretaria.html"><img src="imgs/home.png" alt="Home">Início</a>
        <a href="register.html"><img src="imgs/registro.png" alt="Register">Registrar</a>
        <a href="#"><img src="imgs/turma.png" alt="Class">Desempenho da Turma</a>
        <a href="criarTurmas.html"><img src="imgs/paperplane.png" alt="Message">Criar Turmas</a>
        <a href="#"><img src="imgs/bell.png" alt="Bell">Avisos</a>
        <a href="#"><img src="imgs/calendar.png" alt="Calendar">Calendário</a>
        <a href="#"><img src="imgs/grades.png" alt="Grades">Notas</a>
        <a href="#"><img src="imgs/faltas.png" alt="faltas">Faltas</a>
      </div>
    </nav>

    <main class="main-content">
    <h1>Criar Nova Turma</h1>

    <form id="form-turma" class="form-turma">
        <div class="form-row">
        <label for="ano">Ano:</label>
        <input type="number" id="ano" name="ano" placeholder="Ex: 2025" required>
        </div>

        <div class="form-row">
        <label for="serie">Série:</label>
        <input type="text" id="serie" name="serie" placeholder="Ex: 1ºA" required>
        </div>

        <div class="form-row">
        <label for="disciplinas">Disciplinas:</label>
        <select id="disciplinas" name="disciplinas" multiple required></select>
        </div>

        <button type="submit" class="btn-submit">Criar Turma</button>

    </form>
    </main>



    <script>
  // Carrega disciplinas do backend
        async function carregarDisciplinas() {
    try {
        const resp = await fetch("/api/disciplinas"); 
        const disciplinas = await resp.json();
        console.log("disciplinas recebidas:", disciplinas); // <--- aqui
        const select = document.getElementById("disciplinas");
        
        disciplinas.forEach(d => { 
            const option = document.createElement("option");
            option.value = d.id_disciplina;
            option.textContent = d.nome;
            select.appendChild(option);
        });
    } catch (err) {
        console.error("Erro ao carregar disciplinas", err);
    }
}


        carregarDisciplinas();

        // Envia turma para o backend
        document.getElementById("form-turma").addEventListener("submit", async (e) => {
            e.preventDefault();

            const ano = document.getElementById("ano").value;
            const serie = document.getElementById("serie").value;
            const disciplinas = Array.from(
            document.getElementById("disciplinas").selectedOptions
            ).map(opt => parseInt(opt.value));

            try {
            const resp = await fetch("/api/turmas", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ano, serie, disciplinas })
            });

            const data = await resp.json();
            alert(data.message || 'Salvo com sucesso!');
            } catch (err) {
            alert('Erro ao criar turma');
            console.error(err);
            }
        });
    </script>

  </body>
</html>
